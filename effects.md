# Visual Effects System Review

## Dedicated decal support
The runtime ships with a `DecalSpec` concept inside the shared `EffectManager`; finished instances can expose `handoffToDecal()` and the manager will return those specs from `collectDecals()`.【F:client/js-effects/manager.js†L130-L144】【F:client/js-effects/effects/bloodSplatter.js†L134-L135】【F:client/js-effects/effects/bloodSplatter.js†L275-L326】 However, the game client never calls `collectDecals()` or renders decals separately, so there is no integrated decal system in the shipped experience—effects simply disappear once their instances report that they are finished.【F:client/render.js†L444-L512】 

## Animation-to-decal handoff
Effect definitions such as the blood splatter animation do prepare a decal when they finish, but because the main client ignores `collectDecals()` the handoff is effectively unused. Animations therefore terminate without promoting the decal data anywhere.【F:client/js-effects/manager.js†L130-L144】【F:client/render.js†L444-L512】 

## Animation completion signalling
Animations are driven by the client-side `EffectManager`. Each effect instance reports `isAlive()`; when it flips to `false`, `syncMeleeSwingEffects` / `syncBloodSplatterEffects` remove the instance and the manager stops updating or drawing it.【F:client/render.js†L45-L165】【F:client/render.js†L444-L512】 There is no follow-up step that notifies another renderer or swaps in a static decal because, again, decals are never collected. A blood splatter plays, finishes, and disappears rather than leaving a persistent stain. 

## Server fire-and-forget capability
The server owns a list of active effects and only includes those whose `expiresAt` has not yet passed in each state snapshot.【F:server/simulation.go†L95-L111】 Creation helpers such as `triggerMeleeAttack`, `spawnProjectile`, and `maybeSpawnBloodSplatter` append effects to this list with explicit durations, and the per-tick `advanceEffects` / `pruneEffects` logic moves and expires them.【F:server/effects.go†L218-L305】【F:server/effects.go†L312-L610】【F:server/effects.go†L741-L756】【F:server/effects.go†L777-L805】 Historically the authoritative state forgot an effect as soon as it expired, so the server had to keep the effect alive (and therefore keep sending it) for as long as it should be visible on clients. A new `EffectTrigger` queue now coexists alongside the active effect list so that systems can enqueue one-shot visuals without keeping them in the simulation. When `Hub.advance` snapshots the world it flushes this queue into the outgoing state message, allowing the server to "fire and forget" visuals once they have been handed off.【F:server/effects.go†L14-L38】【F:server/effects.go†L114-L133】【F:server/hub.go†L318-L347】【F:server/messages.go†L1-L20】 No existing abilities use the trigger queue yet, but the infrastructure is in place.

## Server-triggered fire-and-forget events
Clients still replace their `store.effects` array wholesale with each `state` message,【F:client/network.js†L200-L296】 but they now also collect `effectTriggers` into a dedicated queue. The render loop drains that queue, looks up registered fire-and-forget handlers, and lets those handlers decide how to spawn or hand off visuals without needing further server updates.【F:client/render.js†L1-L196】【F:client/render.js†L444-L512】 This gives the rendering layer a place to promote transient animations into decals or other persistent client-side assets once future systems start publishing trigger events.
