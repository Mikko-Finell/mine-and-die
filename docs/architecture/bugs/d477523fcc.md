# Bug Review Notes

## 1. NPC gold mining skips patch emission
- **File(s):** `server/effects.go`
- **Code area:** `World.resolveMeleeImpact`
- **Issue:** When a melee swing overlaps a gold mine, the function awards gold directly to the owning actor. For players it routes through `World.MutateInventory`, but for NPC owners it calls `owner.Inventory.AddStack` directly. That bypasses the journal + patch helpers, so NPC inventory versions never advance and no `npc_inventory` patch is emitted. Clients never learn about the extra gold, and telemetry misses the change.

## 2. `worldConfig.normalized` discards requested NPC totals
- **File(s):** `server/world_config.go`
- **Code area:** `worldConfig.normalized`
- **Issue:** The normalization logic unconditionally overwrites `NPCCount` with the sum of `GoblinCount` and `RatCount`. That means a caller who only sets `npcCount` (leaving the per-species fields unset) will always end up with zero NPCs, because both species counts default to 0 before the overwrite. The server therefore ignores the requested total count and spawns nothing.

## 3. Effect ticks freeze when no emitter is supplied
- **File(s):** `server/effects_manager.go`
- **Code area:** `EffectManager.RunTick`
- **Issue:** The method returns immediately when `emit` is `nil`. That short-circuits the loop that invokes `OnTick` hooks, decrements `TicksRemaining`, and evaluates end policies. Tests and offline callers invoke `RunTick(..., nil)` to advance the simulation without emitting transport events, but this early return prevents contract-managed effects from ever ticking or expiring in that mode.

## 4. Client drops NPC equipment patches
- **File(s):** `client/patches.js`
- **Code area:** `KNOWN_PATCH_KINDS` / `PATCH_HANDLERS`
- **Issue:** The client recognises player equipment patches but never registers `npc_equipment`. The server emits `PatchNPCEquipment` when NPC gear changes (e.g., drops on death), yet the handler table lacks that key. Those patches are logged as unsupported and discarded, so the UI never reflects NPC loadout changes.

