# Simplification Survey

## 1. Align client defaults with server config
- **Files**: `client/network.js`, `server/constants.go`, `server/world_config.go`
- **Focus**: `DEFAULT_*` world generation constants in the client bootstrap logic
- **Proposal**: The client hard-codes obstacle, mine, NPC, goblin, rat, lava counts, and the default world seed even though the authoritative defaults already live in the server config helpers (`defaultGoblinCount`, `defaultNPCCount`, etc.). Plumb these numbers from the server (either via the existing world config payload or a shared module) so we do not have two divergent sources of truth.
- **Why**: Avoiding duplicate defaults removes a class of drift bugs where the lobby shows or assumes different counts than the simulation actually uses, and it lets future balance changes happen in one place.

## 2. Collapse effect spawn logging helpers
- **Files**: `client/network.js`
- **Focus**: `isBloodSplatterSpawn`, `isFireSpawn`, `isAttackSpawn`, `isMeleeSwingSpawn` and their paired `shouldLog*`/`log*` wrappers
- **Proposal**: These helpers repeat identical candidate extraction, message-type gating, and logging flows with only the identifier predicate changing. Replace them with a parameterized factory (e.g., `createEffectSpawnLogger(identifierMatcher, label)`) so we have a single source for spawn detection and logging behaviour.
- **Why**: Eliminating four copies of the same traversal shrinks the file materially, makes it easier to add new tracked effects, and reduces the risk of future edits updating one branch but not the others.

## 3. Share path-following mechanics across actors
- **Files**: `server/player_path.go`, `server/npc_path.go`
- **Focus**: `followPlayerPath`/`followNPCPath`, `ensure*Path`, and the stall/recalc bookkeeping blocks
- **Proposal**: The player and NPC navigation flows perform the same epsilon checks, stall detection, recalc scheduling, and intent updates with only minor differences (e.g., writing to `SetIntent` vs. `intentX`). Extract a shared helper or strategy that accepts actor-specific hooks so we only implement the path progression state machine once.
- **Why**: Consolidating the two nearly-identical implementations will make it easier to tweak thresholds (arrive radius, stall ticks) consistently and lower the risk of one actor type getting bug fixes the other misses.

## 4. Generalize map copy helpers
- **Files**: `server/effects_manager.go`, `server/patches.go`
- **Focus**: `copyIntMap` and `copyBoolMap`
- **Proposal**: Both helpers are identical aside from their value types, and Go generics would let us express a single `copyMap[K comparable, V any]` utility (or even reuse `maps.Clone` now that we target Go 1.21+). Centralize the map cloning logic so the effect system and patch mirroring do not maintain duplicate implementations.
- **Why**: A shared helper removes boilerplate, makes future map copy needs trivial, and clarifies that all these clones follow the same semantics (nil-in, nil-out; shallow copy).
