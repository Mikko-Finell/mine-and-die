# Simplification Opportunities

## 1. Unify player and NPC path following logic
- **Files**: `server/player_path.go`, `server/npc_path.go`
- **Relevant code**: `followPlayerPath`, `ensurePlayerPath`, `recalculatePlayerPath`, and their NPC counterparts that operate on `npc.Blackboard`.
- **Why simplify**: Both modules implement nearly the same path-following state machine (stall detection, radius handling, path recalculation cooldowns) with only data-structure naming differences. Keeping two copies risks drift and makes fixes twice as expensive. Extracting a shared helper that accepts accessors for reading/writing path state would centralize the behavior.

## 2. Collapse repeated inventory/equipment mutation wrappers
- **Files**: `server/world_mutators.go`
- **Relevant code**: `mutateActorInventory`, `mutateActorEquipment`, `MutateInventory`, and `MutateNPCInventory`.
- **Why simplify**: Each function clones state, invokes a mutation closure, and writes patches if something changed. The logic is identical aside from the slice copier and patch kind. A single generic helper that takes the clone/equality/copy functions and patch selector would eliminate four near-copy implementations and make future mutation types easier to add.

## 3. Generalize effect spawn log filters
- **Files**: `client/network.js`
- **Relevant code**: `isBloodSplatterSpawn`, `isFireSpawn`, `isAttackSpawn`, `isMeleeSwingSpawn`, and their paired `shouldLog*` helpers.
- **Why simplify**: Each helper walks the same object graph to collect candidate identifiers before running a type-specific predicate. Parameterizing the traversal over a predicate (and sharing the `collectEffectSpawnEvents` plumbing) would cut hundreds of repeated lines and make adding new effect categories a data entry task instead of another copy-paste block.

## 4. Share effect lifecycle normalization utilities
- **Files**: `client/effect-lifecycle.js`, `client/effect-diagnostics.js`
- **Relevant code**: `coerceSequence`, `coerceTick`, `readString` in `effect-lifecycle.js` and the matching `normalizeSequence`, `normalizeTick`, `normalizeIdentifier` in `effect-diagnostics.js`.
- **Why simplify**: Both modules reimplement the same number parsing and string cleanup helpers with minor naming differences. Moving these into a shared utility (e.g., `client/effect-utils.js`) would reduce duplication, keep normalization rules aligned between runtime handling and diagnostics, and shrink the surface area for subtle mismatches.
