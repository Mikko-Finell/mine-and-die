# Simplification Opportunities

1. **Shared clamp helpers across server packages**
   - **Files:** `server/obstacles.go`, `server/ground_items.go`, `server/stats/formulas.go`, `server/effects_math.go`
   - **Code focus:** Functions named `clamp`, `clampFloat`, and `clampInt` that each implement manual min/max clamping for floats or ints.
   - **Proposal:** Introduce a single reusable helper (e.g., `clampFloat64`, `clampInt`) in a shared server utility file and replace per-file implementations.
   - **Why it helps:** The duplicated clamp logic appears four times today. Centralising it removes copy/paste drift risk, guarantees consistent behaviour for movement, ground item scatter, and stat calculations, and shortens several files that currently re-define the same helper.

2. **Unify effect spawn identifier checks in the client**
   - **Files:** `client/network.js`
   - **Code focus:** Helper pairs like `isBloodSplatterIdentifier`/`isBloodSplatterSpawn`, `isFireIdentifier`/`isFireSpawn`, `isAttackIdentifier`/`isAttackSpawn`, and `isMeleeSwingIdentifier`/`isMeleeSwingSpawn`.
   - **Proposal:** Collapse the repeated identifier normalisation and candidate collection into a single generic helper that accepts the expected effect key, then reuse it for each effect type.
   - **Why it helps:** Each helper repeats the same string lowercasing and nested object traversal, resulting in ~150 lines of near-identical code. A shared helper would reduce maintenance cost when transport envelopes change and keep the detection logic consistent.

3. **Share default world configuration between server and client**
   - **Files:** `server/constants.go`, `server/world_config.go`, `client/network.js`
   - **Code focus:** The duplicated constants for world dimensions, entity counts, and NPC defaults (e.g., `worldWidth`, `defaultGoblinCount`, `DEFAULT_WORLD_WIDTH`).
   - **Proposal:** Serve a single configuration source (perhaps via the state bootstrap payload or a generated shared module) so the client no longer hardcodes copies of the server defaults.
   - **Why it helps:** Divergent constants can silently desync resync requests and default UI values. Centralising them avoids future mismatches when adjusting spawn counts or map size and simplifies the bootstrap logic.

4. **Remove legacy camelCase fallbacks for effect lifecycle batches**
   - **Files:** `client/network.js`, `client/effect-lifecycle.js`
   - **Code focus:** Compatibility branches that read both `effect_spawned`/`effectSpawned`, `effect_update`/`effectUpdate`, `effect_ended`/`effectEnded`, and `effect_seq_cursors`/`effectSeqCursors`.
   - **Proposal:** Confirm the server always emits snake_case (current structs do) and drop the camelCase branches, keeping only the modern field names.
   - **Why it helps:** The fallback paths exist solely for a retired payload format and add repeated optional chaining, array checks, and JSON parsing branches. Removing them simplifies lifecycle ingestion and reduces the chance of missing schema updates.
