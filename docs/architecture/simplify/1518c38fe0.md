# Simplification Survey Scratchpad

## 1. Consolidate effect spawn detection helpers
- **Files**: `client/network.js`
- **Code**: `isBloodSplatterIdentifier`, `isFireIdentifier`, `isAttackIdentifier`, `isMeleeSwingIdentifier`, plus the matching `is*Spawn` helpers.
- **Reason**: All four identifier guards and their spawn inspectors repeat the same lower-casing check and candidate collection boilerplate.
- **Proposal**: Replace the copy/pasted `is*Identifier` and `is*Spawn` functions with a parameterised helper that accepts the canonical effect slug (or predicate) and reuses one routine to gather candidate identifiers from the spawn payload. This reduces maintenance overhead whenever we add a new tracked effect type and ensures future fixes (e.g. handling new fields) happen in exactly one place.

## 2. Share path-following logic between players and NPCs
- **Files**: `server/player_path.go`, `server/npc_path.go`
- **Code**: `followPlayerPath`, `followNPCPath`, `finishPlayerPath`, `finishNPCPath`, `ensurePlayerPath`, `ensureNPCPath`, `recalculatePlayerPath`, `recalculateNPCPath`.
- **Reason**: The player and NPC routines duplicate stall detection, arrival radius defaults, recalc cooldowns, and vector math with only minor differences (field names and setters).
- **Proposal**: Extract a shared path controller (e.g., a generic helper that accepts getters/setters for intent vectors and the owning path state) so both actors reuse the same tick loop. This trims the nearly identical code paths, reduces the risk of behaviour drift, and makes future tuning (like stall thresholds) a single edit.

## 3. Centralize inventory slot reindexing
- **Files**: `server/inventory.go`
- **Code**: `MoveSlot`, `RemoveQuantity`, and the call chain from `RemoveAllOf`.
- **Reason**: Each of these paths manually rebuilds the `Slots` slice and then loops to reset every `InventorySlot.Slot`, so chained operations re-run the same O(n) relabeling work repeatedly.
- **Proposal**: Introduce a small `inv.reindexSlots()` helper (or switch to storing `Slot` implicitly from index) so that mutation paths call a shared routine once per change. This removes duplicated loops, shortens the functions, and helps avoid future bugs where a new mutation forgets to realign slot numbers.

## 4. Deduplicate actor inventory/equipment mutation wrappers
- **Files**: `server/world_mutators.go`
- **Code**: `mutateActorInventory` and `mutateActorEquipment`.
- **Reason**: Both helpers clone the old state, run a callback, revert on error, compare for equality, bump the version, and emit a patch; the only differences are the types involved and the payload constructor.
- **Proposal**: Collapse these into a single generic helper (e.g., parameterised by clone/assign/payload lambdas) so we only maintain one copy of the guard rails. That keeps inventory and equipment patches consistent and avoids forgetting a step when the logic evolves (like adding telemetry or version tracking).
